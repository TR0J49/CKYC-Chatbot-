<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CKYC Chat Bot - Central KYC Records Registry</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- Chat Widget Button -->
<div class="chat-widget-btn" id="chatWidgetBtn" onclick="toggleChat()">
    <i class="fas fa-comments"></i>
    <span class="badge" id="unreadBadge" style="display:none;">1</span>
</div>

<!-- Chat Container -->
<div class="chat-container" id="chatContainer">
    <!-- Chat Header -->
    <div class="chat-header">
        <div class="header-left">
            <div class="logo-icon">
                <i class="fas fa-university"></i>
            </div>
            <div class="header-text">
                <h3 id="headerTitle">Central KYC Records Registry</h3>
                <span class="status-dot"></span>
                <span class="status-text" id="statusText">Online</span>
            </div>
        </div>
        <div class="header-actions">
            <button class="header-btn" onclick="resetChat()" title="New Chat">
                <i class="fas fa-redo-alt"></i>
            </button>
            <button class="header-btn" onclick="toggleChat()" title="Minimize">
                <i class="fas fa-minus"></i>
            </button>
        </div>
    </div>

    <!-- Chat Body -->
    <div class="chat-body" id="chatBody">

        <!-- Language Selection Screen -->
        <div class="screen active" id="languageScreen">
            <div class="welcome-card">
                <div class="welcome-icon">
                    <i class="fas fa-university"></i>
                </div>
                <h2>Hello!! / नमस्कार!!</h2>
                <p>Central KYC Records Registry में आपका स्वागत है</p>
                <p>Welcome to Central KYC Records Registry</p>
                <div class="divider"></div>
                <p class="select-label">Please select your preferred language / कृपया अपनी पसंदीदा भाषा चुनें:</p>
                <div class="option-buttons">
                    <button class="option-btn lang-btn" onclick="selectLanguage('hi')">
                        <span>हिंदी</span>
                    </button>
                    <button class="option-btn lang-btn" onclick="selectLanguage('en')">
                        <span>English</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- User Type Selection Screen -->
        <div class="screen" id="userTypeScreen">
            <div class="bot-message-wrapper">
                <div class="bot-avatar"><i class="fas fa-robot"></i></div>
                <div class="bot-message" id="userTypePrompt">Please select your user type:</div>
            </div>
            <div class="option-buttons vertical">
                <button class="option-btn type-btn" onclick="selectUserType('re')">
                    <i class="fas fa-building"></i>
                    <span id="reLabel">Registered Entity (RE)</span>
                </button>
                <button class="option-btn type-btn" onclick="selectUserType('client')">
                    <i class="fas fa-user"></i>
                    <span id="clientLabel">Client</span>
                </button>
            </div>
        </div>

        <!-- Main Menu Screen -->
        <div class="screen" id="menuScreen">
            <div class="bot-message-wrapper">
                <div class="bot-avatar"><i class="fas fa-robot"></i></div>
                <div class="bot-message" id="menuPrompt">Please choose from the following options:</div>
            </div>
            <div class="option-buttons vertical">
                <button class="option-btn menu-btn" onclick="selectOption('status')">
                    <i class="fas fa-search"></i>
                    <span id="statusLabel">Check Status (API Integration)</span>
                </button>
                <button class="option-btn menu-btn" onclick="selectOption('query')">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="queryLabel">Raise Query/Complaint</span>
                </button>
                <button class="option-btn menu-btn" onclick="selectOption('chat')">
                    <i class="fas fa-question-circle"></i>
                    <span id="chatLabel">Ask a Question</span>
                </button>
            </div>
        </div>

        <!-- API Integration Screen -->
        <div class="screen" id="apiScreen">
            <div class="bot-message-wrapper">
                <div class="bot-avatar"><i class="fas fa-robot"></i></div>
                <div class="bot-message" id="apiPrompt">Please select the service:</div>
            </div>
            <div class="option-buttons vertical">
                <button class="option-btn api-btn" onclick="selectApiOption('registration')">
                    <i class="fas fa-clipboard-check"></i>
                    <span id="regStatusLabel">Know Status of Registration</span>
                </button>
                <button class="option-btn api-btn" onclick="selectApiOption('wallet')">
                    <i class="fas fa-wallet"></i>
                    <span id="walletLabel">Wallet Inquiry</span>
                </button>
                <button class="option-btn api-btn" onclick="selectApiOption('mismatch')">
                    <i class="fas fa-exchange-alt"></i>
                    <span id="mismatchLabel">Mismatch in CKYC Details</span>
                </button>
            </div>
            <button class="back-btn" onclick="goToMenu()">
                <i class="fas fa-arrow-left"></i> <span id="backLabel1">Back to Menu</span>
            </button>
        </div>

        <!-- Registration Status Screen -->
        <div class="screen" id="registrationScreen">
            <div class="bot-message-wrapper">
                <div class="bot-avatar"><i class="fas fa-robot"></i></div>
                <div class="bot-message" id="regPrompt">Please enter your FI registration/acknowledgment number:</div>
            </div>
            <div class="input-group">
                <input type="text" id="regNumberInput" class="form-input" placeholder="Enter registration number...">
                <button class="submit-btn" onclick="checkRegistrationStatus()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div id="regResult" class="result-box" style="display:none;"></div>
            <button class="back-btn" onclick="showScreen('apiScreen')">
                <i class="fas fa-arrow-left"></i> <span id="backLabel2">Back</span>
            </button>
        </div>

        <!-- Wallet Inquiry Screen -->
        <div class="screen" id="walletScreen">
            <div class="bot-message-wrapper">
                <div class="bot-avatar"><i class="fas fa-robot"></i></div>
                <div class="bot-message" id="walletPrompt">Please enter your RE registration number (numeric only):</div>
            </div>
            <div class="input-group">
                <input type="text" id="reNumberInput" class="form-input" placeholder="RE registration number...">
                <button class="submit-btn" onclick="showWalletOptions()">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <div id="walletOptions" class="option-buttons vertical" style="display:none;">
                <button class="option-btn wallet-opt-btn" onclick="walletInquiry(1)">
                    <i class="fas fa-coins"></i> <span id="wOpt1">Available Balance</span>
                </button>
                <button class="option-btn wallet-opt-btn" onclick="walletInquiry(2)">
                    <i class="fas fa-percentage"></i> <span id="wOpt2">TDS on Hold</span>
                </button>
                <button class="option-btn wallet-opt-btn" onclick="walletInquiry(3)">
                    <i class="fas fa-chart-line"></i> <span id="wOpt3">Threshold Limit</span>
                </button>
                <button class="option-btn wallet-opt-btn" onclick="walletInquiry(4)">
                    <i class="fas fa-balance-scale"></i> <span id="wOpt4">Minimum Balance Limit</span>
                </button>
            </div>
            <div id="walletResult" class="result-box" style="display:none;"></div>
            <button class="back-btn" onclick="showScreen('apiScreen')">
                <i class="fas fa-arrow-left"></i> <span id="backLabel3">Back</span>
            </button>
        </div>

        <!-- Mismatch Screen -->
        <div class="screen" id="mismatchScreen">
            <div class="bot-message-wrapper">
                <div class="bot-avatar"><i class="fas fa-robot"></i></div>
                <div class="bot-message" id="mismatchPrompt">Please enter your 14-digit CKYC number:</div>
            </div>
            <div class="input-group">
                <input type="text" id="ckycNumberInput" class="form-input" maxlength="14" placeholder="14-digit CKYC number...">
                <button class="submit-btn" onclick="checkMismatch()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div id="mismatchResult" class="result-box" style="display:none;"></div>
            <button class="back-btn" onclick="showScreen('apiScreen')">
                <i class="fas fa-arrow-left"></i> <span id="backLabel4">Back</span>
            </button>
        </div>

        <!-- Chat Screen -->
        <div class="screen" id="chatScreen">
            <div class="messages" id="messagesContainer">
                <!-- Messages will be dynamically added here -->
            </div>
        </div>

        <!-- Feedback Screen -->
        <div class="screen" id="feedbackScreen">
            <div class="feedback-card">
                <div class="feedback-icon"><i class="fas fa-star"></i></div>
                <h3 id="feedbackTitle">Could you tell us about your experience?</h3>
                <p id="feedbackSubtitle">We'd be thrilled to hear from you!</p>
                <div class="rating-buttons">
                    <button class="rating-btn very-bad" onclick="selectRating(1, 'Very Bad')">
                        <i class="fas fa-angry"></i>
                        <span id="rVeryBad">Very Bad</span>
                    </button>
                    <button class="rating-btn bad" onclick="selectRating(2, 'Bad')">
                        <i class="fas fa-frown"></i>
                        <span id="rBad">Bad</span>
                    </button>
                    <button class="rating-btn good" onclick="selectRating(3, 'Good')">
                        <i class="fas fa-smile"></i>
                        <span id="rGood">Good</span>
                    </button>
                    <button class="rating-btn very-good" onclick="selectRating(4, 'Very Good')">
                        <i class="fas fa-grin"></i>
                        <span id="rVeryGood">Very Good</span>
                    </button>
                    <button class="rating-btn excellent" onclick="selectRating(5, 'Excellent')">
                        <i class="fas fa-grin-stars"></i>
                        <span id="rExcellent">Excellent</span>
                    </button>
                </div>
                <div id="feedbackTextArea" style="display:none;">
                    <textarea id="feedbackText" class="feedback-textarea" placeholder="Please share your feedback..." rows="3"></textarea>
                    <button class="submit-feedback-btn" onclick="submitFeedback()">
                        <i class="fas fa-paper-plane"></i> <span id="submitFbLabel">Submit</span>
                    </button>
                </div>
                <div id="feedbackResponse" class="feedback-response" style="display:none;"></div>
            </div>
        </div>

        <!-- Thank You Screen -->
        <div class="screen" id="thankYouScreen">
            <div class="thankyou-card">
                <div class="thankyou-icon"><i class="fas fa-check-circle"></i></div>
                <h3 id="thankYouMsg">Thank you for contacting Central KYC Records Registry. Have a nice day!</h3>
                <button class="option-btn" onclick="resetChat()" style="margin-top:20px;">
                    <i class="fas fa-redo"></i> <span id="startNewLabel">Start New Chat</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Chat Input (visible only in chat mode) -->
    <div class="chat-input-area" id="chatInputArea" style="display:none;">
        <div class="input-row">
            <input type="text" id="chatInput" class="chat-text-input" placeholder="Type your question here..." onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        <div class="input-actions">
            <button class="action-btn" onclick="goToMenu()" title="Back to Menu">
                <i class="fas fa-th-large"></i> <span id="menuBtnLabel">Menu</span>
            </button>
            <button class="action-btn" onclick="endChat()" title="End Chat">
                <i class="fas fa-sign-out-alt"></i> <span id="endChatLabel">End Chat</span>
            </button>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>
</html>
